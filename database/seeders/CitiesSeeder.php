<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\City;
use App\Models\Country;
use Illuminate\Support\Facades\DB;

class CitiesSeeder extends Seeder
{
    public function run()
    {
        // فحص أولي للبلدان الموجودة
        echo "فحص البلدان الموجودة...\n";
        $existingCountries = Country::all()->pluck('name')->toArray();
        echo "البلدان الموجودة: " . implode(', ', $existingCountries) . "\n\n";
        
        $countriesWithCities = [
            'المغرب' => [
                'الرباط', 'الدار البيضاء', 'فاس', 'مراكش', 'أكادير',
                'طنجة', 'مكناس', 'وجدة', 'القنيطرة', 'تطوان',
                'سلا', 'المحمدية', 'خريبكة', 'بني ملال', 'الجديدة',
                'تازة', 'نادور', 'سطات', 'الراشيدية', 'الحسيمة'
            ],
            
            'السعودية' => [
                'الرياض', 'جدة', 'مكة المكرمة', 'المدينة المنورة', 'الدمام',
                'تبوك', 'بريدة', 'الطائف', 'الخبر', 'حائل',
                'الجبيل', 'الباحة', 'نجران', 'جازان', 'عرعر',
                'سكاكا', 'أبها', 'القطيف', 'الظهران', 'ينبع'
            ],
            
            'مصر' => [
                'القاهرة', 'الإسكندرية', 'الجيزة', 'شبرا الخيمة', 'بورسعيد',
                'السويس', 'الأقصر', 'أسوان', 'الفيوم', 'الزقازيق',
                'إسماعيلية', 'أسيوط', 'دمنهور', 'المنيا', 'دمياط',
                'بنها', 'كفر الشيخ', 'قنا', 'سوهاج', 'العريش'
            ],
            
            'الجزائر' => [
                'الجزائر العاصمة', 'وهران', 'قسنطينة', 'عنابة', 'باتنة',
                'سطيف', 'بجاية', 'سيدي بلعباس', 'بسكرة', 'تلمسان',
                'ورقلة', 'بشار', 'تيزي وزو', 'الجلفة', 'مستغانم',
                'تبسة', 'غرداية', 'الشلف', 'معسكر', 'المسيلة'
            ],
            
            'الإمارات' => [
                'أبوظبي', 'دبي', 'الشارقة', 'العين', 'عجمان',
                'رأس الخيمة', 'الفجيرة', 'أم القيوين', 'خورفكان', 'كلباء',
                'دبا الفجيرة', 'الذيد', 'مدينة زايد', 'ليوا', 'مرفأ'
            ],
            
            'الكويت' => [
                'مدينة الكويت', 'حولي', 'الفروانية', 'الأحمدي', 'الجهراء',
                'مبارك الكبير', 'السالمية', 'الفحيحيل', 'الصباحية', 'الرقة',
                'أبرق خيطان', 'كيفان', 'الفنطاس', 'الجابرية', 'خيطان'
            ],
            
            'عمان' => [
                'مسقط', 'صلالة', 'السيب', 'صحار', 'نزوى',
                'البريمي', 'الرستاق', 'صور', 'بركاء', 'عبري',
                'بهلاء', 'إبراء', 'الخابورة', 'شناص', 'صحم'
            ],
            
            'الأردن' => [
                'عمان', 'إربد', 'الزرقاء', 'الرصيفة', 'وادي السير',
                'العقبة', 'السلط', 'الكرك', 'مادبا', 'جرش',
                'عجلون', 'معان', 'الطفيلة', 'الزرقاء الجديدة', 'سحاب'
            ],
            
            'لبنان' => [
                'بيروت', 'طرابلس', 'صيدا', 'صور', 'النبطية',
                'بعلبك', 'جونيه', 'زحلة', 'البترون', 'جبيل',
                'الدامور', 'المتن', 'كسروان', 'الشوف', 'عكار'
            ],
            
            'سوريا' => [
                'دمشق', 'حلب', 'حمص', 'حماة', 'اللاذقية',
                'دير الزور', 'الرقة', 'درعا', 'الحسكة', 'القامشلي',
                'طرطوس', 'إدلب', 'السويداء', 'القنيطرة', 'الباب'
            ],
            
            'تونس' => [
                'تونس العاصمة', 'صفاقس', 'سوسة', 'أريانة', 'القيروان',
                'بنزرت', 'قابس', 'قفصة', 'المنستير', 'مدنين',
                'تطاوين', 'المهدية', 'نابل', 'باجة', 'جندوبة'
            ],
            
            'قطر' => [
                'الدوحة', 'الريان', 'أم صلال', 'الوكرة', 'الخور',
                'دخان', 'الشمال', 'الغويرية', 'المسيعيد', 'الزبارة',
                'فويرط', 'الثميد', 'سيلين', 'العديد', 'الودع'
            ],
            
            'البحرين' => [
                'المنامة', 'المحرق', 'الرفاع', 'حمد', 'عيسى',
                'سترة', 'جدحفص', 'الزلاق', 'عالي', 'البديع',
                'كرباباد', 'سلماباد', 'الدراز', 'كرزكان', 'العكر'
            ],
            
            'العراق' => [
                'بغداد', 'البصرة', 'الموصل', 'أربيل', 'النجف',
                'كربلاء', 'السليمانية', 'كركوك', 'الحلة', 'الرمادي',
                'الناصرية', 'العمارة', 'الكوت', 'سامراء', 'الفلوجة'
            ],
            
            'اليمن' => [
                'صنعاء', 'عدن', 'تعز', 'الحديدة', 'إب',
                'ذمار', 'المكلا', 'سيئون', 'زنجبار', 'الضالع',
                'أبين', 'لحج', 'شبوة', 'مأرب', 'الجوف'
            ],
            
            'السودان' => [
                'الخرطوم', 'أم درمان', 'الخرطوم بحري', 'بورتسودان', 'كسلا',
                'الأبيض', 'نيالا', 'الجنينة', 'كوستي', 'ود مدني',
                'الدمازين', 'القضارف', 'عطبرة', 'دنقلا', 'كريمة'
            ],
            
            'ليبيا' => [
                'طرابلس', 'بنغازي', 'مصراتة', 'الزاوية', 'البيضاء',
                'أجدابيا', 'الخمس', 'توكرة', 'درنة', 'سبها',
                'زليتن', 'غريان', 'صبراتة', 'زوارة', 'بني وليد'
            ],
            
            'الصومال' => [
                'مقديشو', 'هرجيسا', 'بربرة', 'بوساسو', 'جالكايو',
                'كيسمايو', 'بيدوا', 'مركا', 'بوراما', 'لاسكانود',
                'جوهر', 'أفجوي', 'باكول', 'بلدوين', 'دولو'
            ],
            
            'فلسطين' => [
                'القدس', 'غزة', 'الخليل', 'نابلس', 'رام الله',
                'بيت لحم', 'جنين', 'طولكرم', 'قلقيلية', 'سلفيت',
                'أريحا', 'طوباس', 'رفح', 'خان يونس', 'دير البلح'
            ],
            
            'موريتانيا' => [
                'نواكشوط', 'نواديبو', 'روصو', 'كيفة', 'العيون',
                'زويرات', 'أطار', 'شنقيط', 'تيشيت', 'ولاتة',
                'المذرذرة', 'مقطع لحجار', 'بوغي', 'امبود', 'باركيول'
            ]
        ];

        // إنشاء البلدان والمدن
        foreach ($countriesWithCities as $countryName => $cities) {
            echo "معالجة {$countryName}...\n";
            
            // البحث عن البلد أو إنشاؤه بأمان
            $country = Country::firstOrCreate(['name' => $countryName]);
            
            if ($country->wasRecentlyCreated) {
                echo "✅ تم إنشاء بلد جديد: {$countryName}\n";
            } else {
                echo "ℹ️  البلد موجود مسبقاً: {$countryName}\n";
            }
            
            // فحص المدن الموجودة لهذا البلد
            $existingCitiesCount = City::where('country_id', $country->id)->count();
            echo "المدن الموجودة مسبقاً: {$existingCitiesCount}\n";
            
            // إضافة المدن للبلد
            $newCitiesCount = 0;
            foreach ($cities as $cityName) {
                $city = City::firstOrCreate([
                    'name' => $cityName,
                    'country_id' => $country->id
                ]);
                
                if ($city->wasRecentlyCreated) {
                    $newCitiesCount++;
                }
            }
            
            echo "تم إضافة {$newCitiesCount} مدينة جديدة لـ {$countryName}\n";
            echo "إجمالي المدن الآن: " . City::where('country_id', $country->id)->count() . "\n\n";
        }
        
        // إحصائيات نهائية
        $totalCountries = Country::count();
        $totalCities = City::count();
        echo "=== الإحصائيات النهائية ===\n";
        echo "إجمالي البلدان: {$totalCountries}\n";
        echo "إجمالي المدن: {$totalCities}\n";
        echo "تم إنهاء العملية بنجاح! ✅\n";
    }
}
